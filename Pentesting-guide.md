#REPORT
----------------------------------

####SQL Injection

1. **Nguyên nhân**:
 	- App sử dụng input của người dùng mà không thông qua việc làm sạch các kí tự liên quan với ngôn ngữ truy vẫn SQL như ***",',-,...***.
 	- Sử dụng phương pháp cộng chuỗi để ghép input người dùng vào câu lệnh SQL và truyền xuống database.
 	- Các input có thể là: username, password, search-keyword, cookies,...
2. **Phân loại:**
 	* In-band SQL Injection: Đây là loại cổ điển, phổ biến và dễ khai thác nhất, bởi vì output đều rõ ràng và chúng ta có thể nhận biết khá dễ dàng.
 	
		* Error-Based SQLi: Dựa trên các lỗi, exception được xuất ra màn hình khi có các hàm hoặc query chạy sai. Trong một số trường hợp, chỉ Error-Based không đủ để có thể liệt kê một số trường của database.
		* Union-Based SQLi: Loại tấn công dựa trên câu lệnh **UNION** với 2 mệnh đề **SELECT**, app sẽ xuất ra data mà atker cần dưới dạng plain-text. Các lệnh hỗ trợ đi kèm thường là ***limit, order by, offset,...***.
 	* Inferential SQL Injection: Hay còn được biết với cái tên Blind SQL Injection. Đúng như cái tên, vì output không được xuất ra hoặc không rõ ràng nên phải dựa vào cách mà app phản ứng đối với các query lạ như *sleep(), benchmark(),...*
 		* Time-Based SQLi: Dựa vào thời gian delay của app để truy xuất thông tin thông qua các câu điều kiện như ***IF,...***
 		* Boolean-Based SQLi: Dựa vào "giá trị" đúng/sai của câu query bằng toán tử ***&&*** và các hàm như ***ascii(), exists(),...***
 	* Out of band SQL Injection:
 	* Một số loại khác: Second order SQL Injection (kết hợp cả 2 loại trên),...

3. **Attker có thể làm được gì với SQL injection:**
 	* Tất nhiên điều gần như chắc chắn có thể làm là truy xuất thông tin của database, tất cả dữ liệu nằm trong database một cách không hợp lệ.
 	* Nguy cơ cao hơn là có thể bị thay đổi dữ liệu trong database nếu như developer phân quyền không cẩn thận. Attker có thể làm việc này thông qua các câu truy vấn như ***DROP TABLES, UPDATE, INSERT, DELETE, MODIFY,....***
 	* Ngoài ra, SQLi có thể dẫn đến RCE nhờ vào chức ra output INTO OUTFILE của SQL, điều này tạo cho attker khả năng ghi file(chỉ trong một số trường hợp) đặc biết là file đuôi **.php**.

4. **Bypass:**
Tuy đã có cơ chế để lọc một số input nhưng bên cạnh đó vẫn có cách để bypass chúng, dưới đây là một số cách:
	* URL Encoding:
		* ***?id=1%27+or+1=1+--+-***
	* Muti-Encoding:
		* ***?id=1%2527%2Bor%2B1=1%2B--***. Khi đó %2527 sẽ trở thành %27 = "
	* Blacklist:
		![alt text](../img/code1.png)
		* ***?id=1 UniOn sElEct * FrOm users -- -***. Nguyên nhân là do code phân biệt chữ hoa và chữ thường.

		![alt text](../img/code2.png)
		
		* Ở đây code đã replace mà không phân biệt hoa thường, payload như sau: ?id=1 UNI**UNION**ON SE**SELECT**LECT * FR**FROM**OM users -- -
	
		* Dựa trên ***Parameter Pollution***:  Một số ứng dụng khi nhận nhiều hơn 1 các tham số trùng tên sẽ sử dụng tham số đâu tiền, một số sử dụng tham số sau cùng, một số lại xử lí tất các tham số đó, có thể thông qua điểm này để bypass blacklist.Ví dụ payload: 
		***?id=1+unio&id=n+selec&id=t+*+fro&id=m+user+--+-***
	* SQL comment:
	* Other:
5. **Khắc phục:**